(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const g of n.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&a(g)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class p{constructor(){this.isLoaded=!1,this.totalAssets=0,this.loadedAssets=0,this.assets=new Map,this.loadingAssets=new Map,this.onProgressCallbacks=[],this.onCompleteCallbacks=[],this.onErrorCallbacks=[]}register(e,t,a){if(this.assets.has(e)){console.warn(`Asset with key "${e}" is already registered.`);return}if(this.loadingAssets.has(e)){console.warn(`Asset with key "${e}" is already being loaded.`);return}this.totalAssets++,this.loadingAssets.set(e,{url:t,type:a})}loadAll(){this.loadingAssets.forEach((e,t)=>this.loadAsset(t,e.url,e.type))}get(e){return this.assets.get(e)}has(e){return this.assets.has(e)}onProgress(e){this.onProgressCallbacks.push(e)}onComplete(e){this.onCompleteCallbacks.push(e)}onError(e){this.onErrorCallbacks.push(e)}loadAsset(e,t,a){switch(a.toLowerCase()){case"image":this.loadImage(e,t);break;case"audio":this.loadAudio(e,t);break;case"json":this.loadJSON(e,t);break;default:this.onErrorCallbacks.forEach(i=>i(`Unsupported asset type: ${a}`))}}loadImage(e,t){const a=new Image;a.onload=()=>{this.assets.set(e,a),this.assetLoaded(e)},a.onerror=i=>{this.onErrorCallbacks.forEach(n=>n(`Failed to load image: ${t} - ${i.message}`))},a.src=t}loadAudio(e,t){const a=new Audio;a.preload="auto",a.volume=1,a.src=t;const i=()=>{this.assets.set(e,a),this.assetLoaded(e)};a.addEventListener("canplaythrough",i,{once:!0}),a.addEventListener("error",n=>{new Error(`Failed to load audio: ${t} - ${n.message}`)})}loadJSON(e,t){fetch(t).then(a=>{if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return a.json()}).then(a=>{this.assets.set(e,a),this.assetLoaded(e)}).catch(a=>{this.onErrorCallbacks.forEach(i=>i(`Failed to load JSON: ${t} - ${a.message}`))})}assetLoaded(e){this.loadedAssets++,this.loadingAssets.delete(e),this.onProgressCallbacks.forEach(t=>t(this.getProgress())),this.loadingAssets.size===0&&(this.isLoaded=!0,this.onCompleteCallbacks.forEach(t=>t()))}getProgress(){return this.totalAssets>0?this.loadedAssets/this.totalAssets:1}clear(){this.assets.clear(),this.loadingAssets.clear(),this.isLoaded=!1,this.totalAssets=0,this.loadedAssets=0}}class s{constructor(e,t){arguments.length>0&&(this.x=e,this.y=t)}clone(){return new s(this.x,this.y)}add(e){return new s(this.x+e.x,this.y+e.y)}addEquals(e){return this.x+=e.x,this.y+=e.y,this}offset(e,t){var a=0;if(!(t.x<=this.x||this.x+e.x<=0)){var i=t.x*e.y-e.x*t.y,n,g;i>0?this.x<0?(n=this.x*e.y,g=n/e.x-this.y):this.x>0?(n=this.x*t.y,g=n/t.x-this.y):g=-this.y:t.x<this.x+e.x?(n=(t.x-this.x)*e.y,g=t.y-(this.y+n/e.x)):t.x>this.x+e.x?(n=(e.x+this.x)*t.y,g=n/t.x-(this.y+e.y)):g=t.y-(this.y+e.y),g>0&&(a=g)}return a}rmoveto(e,t){this.x+=e,this.y+=t}scalarAdd(e){return new s(this.x+e,this.y+e)}scalarAddEquals(e){return this.x+=e,this.y+=e,this}subtract(e){return new s(this.x-e.x,this.y-e.y)}subtractEquals(e){return this.x-=e.x,this.y-=e.y,this}scalarSubtract(e){return new s(this.x-e,this.y-e)}scalarSubtractEquals(e){return this.x-=e,this.y-=e,this}multiply(e){return new s(this.x*e,this.y*e)}multiplyEquals(e){return this.x*=e,this.y*=e,this}divide(e){return new s(this.x/e,this.y/e)}divideEquals(e){return this.x/=e,this.y/=e,this}compare(e){return this.x-e.x||this.y-e.y}eq(e){return this.x==e.x&&this.y==e.y}lt(e){return this.x<e.x&&this.y<e.y}lte(e){return this.x<=e.x&&this.y<=e.y}gt(e){return this.x>e.x&&this.y>e.y}gte(e){return this.x>=e.x&&this.y>=e.y}lerp(e,t){return new s(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t)}distanceFrom(e){var t=this.x-e.x,a=this.y-e.y;return Math.sqrt(t*t+a*a)}min(e){return new s(Math.min(this.x,e.x),Math.min(this.y,e.y))}max(e){return new s(Math.max(this.x,e.x),Math.max(this.y,e.y))}toString(){return this.x+","+this.y}setXY(e,t){this.x=e,this.y=t}setFromPoint(e){this.x=e.x,this.y=e.y}swap(e){var t=this.x,a=this.y;this.x=e.x,this.y=e.y,e.x=t,e.y=a}}class c{constructor(e){this.game=e,this.x=0,this.y=0,this.down=!1,this.up=!1,this.moving=!1,this.interval=null,this.touches=[],this.element=this.game.canvas,this.element.onpointermove=t=>{t.preventDefault(),this.onPointerMove(t)},this.element.onpointerdown=t=>{t.preventDefault(),this.onPointerDown(t)},this.element.onpointerup=t=>{t.preventDefault(),this.onPointerUp(t)}}isOverPiece(e){for(var t=[new s(e.position.x,e.position.y),new s(e.position.x+e.image.width,e.position.y),new s(e.position.x+e.image.width,e.position.y+e.image.height),new s(e.position.x,e.position.y+e.image.height)],a=new s(this.x,this.y),i=!1,n=-1,g=t.length,l=g-1;++n<g;l=n)(t[n].y<=a.y&&a.y<t[l].y||t[l].y<=a.y&&a.y<t[n].y)&&a.x<(t[l].x-t[n].x)*(a.y-t[n].y)/(t[l].y-t[n].y)+t[n].x&&(i=!i);return i}onPointerMove(e){this.x=e.x/this.game.scale,this.y=e.y/this.game.scale,this.moving=!0,this.movingInterval(),this.event=e}movingInterval(){this.interval=setTimeout(()=>{this.moving=!1,debug_moving.value=!1,this.movingClearInterval()},1e3)}movingClearInterval(){clearInterval(this.interval)}onPointerDown(e){this.x=e.x/this.game.scale,this.y=e.y/this.game.scale,this.down=!0,this.up=!1,this.event=e;for(var t=!1,a=0;a<this.game.puzzle.pieces.length;a++){var i=this.game.puzzle.pieces[a];i.placed||(!t&&this.isOverPiece(i)&&(t=!0),t&&!this.game.selected&&(this.game.over=i,this.game.selected=this.game.over))}}onPointerUp(e){if(this.x=e.x/this.game.scale,this.y=e.y/this.game.scale,this.up=!0,this.down=!1,this.event=e,this.game.selected&&this.game.selected.near()&&!this.game.selected.placed){this.game.selected.position.x=this.game.selected.holder.position.x,this.game.selected.position.y=this.game.selected.holder.position.y,this.game.selected.placed=!0,this.game.selected.moveble=!1,this.game.puzzle.placedPieces.push(this.game.selected);var t=this.game.assetManager.get("drip");t.currentTime!=0&&(t.currentTime=0),t.play()}else if(this.game.selected&&!this.game.selected.near()){this.game.selected.p=0,this.game.selected.moveble=!1,this.game.selected.placed=!1;var a=this.game.assetManager.get("twang");a.currentTime!=0&&(a.currentTime=0),a.play()}this.game.selected=null}}class u{constructor(e=0,t=null,a=null,i=null){this.id=e,this.game=t,this.image=a,this.position=i}draw(){this.game.context.save(),this.game.context.drawImage(this.image,this.position.x,this.position.y),this.game.context.restore()}}class m{constructor(e=0,t=null,a=null,i=null,n=null,g=null){this.id=e,this.game=t,this.image=a,this.position=n,this.initial=g,this.holder=i,this.movable=!0,this.placed=!1,this.moving=!1,this.m=(i.position.y-this.y)/(i.position.x-this.x),this.b=i.position.y-this.m*i.position.x,Math.random()>=.5?this.p=.1:this.p=-.1,this.tolerance=200}draw(){!this.movable&&!this.placed?(this.position.x=this.initial.x,this.position.y=this.initial.y,this.movable=!0,this.game.context.save(),this.game.context.globalAlpha=1,this.game.context.beginPath(),this.game.context.drawImage(this.image,this.position.x/this.game.scale,this.position.y/this.game.scale)):(this.game.context.save(),this.placed?this.game.context.globalAlpha=1:this.game.is_over?this.game.context.globalAlpha=1:this.game.context.globalAlpha=.8,this.game.context.fillStyle="rgba(255, 255, 255, 0.5)",this.game.selected==this&&(this.game.context.fillStyle="rgba(0, 0, 255, 0.1)"),this.near()&&this==this.game.selected&&(this.game.context.fillStyle="rgba(0, 255, 0, 0.1)",this.game.autoSnap==!0&&!this.placed&&(this.game.selected.position.x=this.game.selected.holder.position.x,this.game.selected.position.y=this.game.selected.holder.position.y,this.game.selected.placed=!0,this.game.selected.movable=!1,this.game.puzzle.placedPieces.push(this.game.selected),this.game.assetManager.get("drip").play())),this.game.context.beginPath(),this.game.context.drawImage(this.image,this.position.x,this.position.y),this.game.context.closePath(),this.game.context.restore())}near(){var e=!1,t=this.position.x-this.holder.position.x,a=this.position.y-this.holder.position.y,i=t*t+a*a;return i<=this.tolerance&&(e=!0),e}}class o{constructor(e,t,a,i,n,g,l,d){console.log(`creating puzzle ${e}...`),this.id=e,this.game=t,this.image=a,this.piecesImages=i,this.holdersImages=n,g&&(this.hasVoice=g.has_voice,this.hasSound=g.has_sound),l&&(this.width=l.width,this.height=l.height),this.positions=d,this.numberOfPieces=d.length,this.timeToComplete=this.numberOfPieces*30,this.remainingTime=this.numberOfPieces*30,this.pieces=[],this.holders=[],this.placedPieces=[],this.position=null,this.loaded=!1,this.solved=!1,this.assetManager=new p}init(){console.log(`initing puzzle ${this.id}...`),this.loaded=!1,this.solved=!1,this.loadAssets()}loadAssets(){this.assetManager.register(`puzzle_${this.id}_image`,`./stages/${this.id}/${this.id}.png`,"image");for(var e=0;e<this.numberOfPieces;e++)this.assetManager.register(`puzzle_${this.id}_holder_${e}`,this.holdersImages[e],"image"),this.assetManager.register(`puzzle_${this.id}_piece_${e}`,this.piecesImages[e],"image");stage_voice.setAttribute("disabled",!0),this.hasVoice&&this.assetManager.register(`puzzle_${this.id}_voice`,`./stages/${this.id}/voice.mp3`,"audio"),stage_sound.setAttribute("disabled",!0),this.hasSound&&this.assetManager.register(`puzzle_${this.id}_sound`,`./stages/${this.id}/sound.mp3`,"audio"),this.assetManager.onComplete(()=>{console.log(`All assets loaded (puzzle ${this.id})!`),this.placeHolderAndPieces()}),this.assetManager.loadAll()}placeHolderAndPieces(){for(var e=0;e<this.numberOfPieces;e++){var t=this.assetManager.get(`puzzle_${this.id}_holder_${e}`),a=this.placeHolder(e,t),i=this.assetManager.get(`puzzle_${this.id}_piece_${e}`);this.placePiece(e,i,a)}}placeHolderAndPiecesAgain(){this.holders=[],this.pieces=[],this.placedPieces=[],this.placeHolderAndPieces()}placePiece(e,t,a){var i=Math.floor(Math.random()*(this.game.canvas.width/this.game.scale-t.width)),n=Math.floor(Math.random()*(this.game.canvas.height/this.game.scale-t.height));n<80&&(n+=80),n>this.game.canvas.height-20&&(n-=80),i<80&&(i+=80),i>this.game.canvas.width-80&&(i-=80),this.pieces.push(new m(e,this.game,t,a,new s(i,n),new s(i,n),!0,!1))}placeHolder(e,t){this.xx=this.game.canvas.width/this.game.scale/2-this.width/2,this.yy=this.game.canvas.height/this.game.scale/2-this.height/2;var a=this.positions[e].x+this.xx,i=this.positions[e].y+this.yy,n=new u(e,this.game,t,new s(a,i),!1);return this.holders.push(n),n}draw(){if(this.solved){var e=this.assetManager.get(`puzzle_${this.id}_image`);this.game.context.drawImage(e,this.game.canvas.width/this.game.scale/2-e.width/2,this.game.canvas.height/this.game.scale/2-e.height/2)}else if(this.numberOfPieces>this.placedPieces.length){for(var t=0;t<this.holders.length;t++)this.holders[t].draw();for(var a=new Array,i=!1,t=0;t<this.pieces.length;t++){var n=this.pieces[t];n.placed?n!=this.game.selected&&n.draw():a.push(n)}i||(this.game.over=null),this.game.selected!=null&&this.game.selected.movable&&(this.game.selected.x=this.game.pointer.x,this.game.selected.y=this.game.pointer.y);for(var t=0;t<a.length;t++)a[t].draw();this.game.selected&&this.game.selected.draw(),this.game.selected!=null&&this.game.selected.movable&&(this.game.selected.position.x=this.game.pointer.x-this.game.selected.image.width/2,this.game.selected.position.y=this.game.pointer.y-this.game.selected.image.height/2),this.remainingTime<=0&&(this.game.stopGame(),confirm("Timeup! Lets try again?")&&(this.game.isOver=!1,this.game.init(),this.game.startGame()))}else this.game.isOver||(this.game.isOver=!0,this.solved=!0,this.playAudio())}playAudio(){if(this.game.pauseGame(),document.getElementById("stage_text").textContent=`Stage ${this.game.stage} completed!`,document.getElementById("stage_score").textContent=`${this.numberOfPieces} pieces placed in ${this.timeToComplete-this.remainingTime} seconds.`,this.game.assetManager.get("chimes").play(),this.hasVoice){var e=this.assetManager.get(`puzzle_${this.id}_voice`);e.addEventListener("ended",()=>{stage_voice.removeAttribute("disabled")}),e.play()}if(this.hasSound){var t=this.assetManager.get(`puzzle_${this.id}_sound`);t.addEventListener("ended",()=>{stage_sound.removeAttribute("disabled")}),t.play()}stage_modal.showModal()}}class w{constructor(e){this.started=!1,this.paused=!1,this.stage=1,this.scale=1,this.alpha=1,this.fade1=0,this.fade2=0,this.debug=!1,this.interval=null,this.maxElapsedTime=0,this.startTime=0,this.canvas=e,this.context=this.canvas.getContext("2d"),this.canvas.width=Math.round(window.innerWidth),this.canvas.height=Math.round(window.innerHeight),console.log("canvas: "+this.canvas.width+", "+this.canvas.height),this.originalWidth=this.canvas.width,this.originalHeight=this.canvas.height,this.fontSize=Math.round(this.canvas.width/20),this.scaledWidth=this.canvas.width/this.scale/2,this.scaledHeight=this.canvas.height/this.scale/2,console.log("scaled_width: "+this.scaledWidth),console.log("scaled_height: "+this.scaledHeight),this.assetManager=new p,this.assetManager.onProgress(t=>{console.log(`Loading: ${(t*100).toFixed(1)}%`)}),this.assetManager.onError(t=>{console.error("Asset loading error:",t)}),this.assetManager.onComplete(()=>{this.started||this.startGame()}),this.assetManager.register("drip","./audio/drip.mp3","audio"),this.assetManager.register("twang","./audio/twang.mp3","audio"),this.assetManager.register("bgm","./audio/bgm.mp3","audio"),this.assetManager.register("chimes","./audio/chimes.mp3","audio"),this.assetManager.loadAll(),this.autoSnap=!0,this.moving=!0,this.selected=null,this.isOver=!1,this.clockInterval=null,this.pointer=new c(this)}init(){this.puzzles=[new o("001",this,"./stages/001/001.png",["./stages/001/p01.png","./stages/001/p02.png","./stages/001/p03.png","./stages/001/p04.png","./stages/001/p05.png","./stages/001/p06.png","./stages/001/p07.png"],["./stages/001/h01.png","./stages/001/h02.png","./stages/001/h03.png","./stages/001/h04.png","./stages/001/h05.png","./stages/001/h06.png","./stages/001/h07.png"],{has_voice:!0,has_sound:!1},{width:306,height:347},[new s(0,14),new s(89,0),new s(90,34),new s(84,84),new s(56,164),new s(173,161),new s(20,234)]),new o("002",this,"./stages/002/002.png",["./stages/002/p01.png","./stages/002/p02.png","./stages/002/p03.png","./stages/002/p04.png","./stages/002/p05.png","./stages/002/p06.png","./stages/002/p07.png","./stages/002/p08.png","./stages/002/p09.png"],["./stages/002/h01.png","./stages/002/h02.png","./stages/002/h03.png","./stages/002/h04.png","./stages/002/h05.png","./stages/002/h06.png","./stages/002/h07.png","./stages/002/h08.png","./stages/002/h09.png"],{has_voice:!0,has_sound:!1},{width:434,height:300},[new s(30,18),new s(0,81),new s(192,5),new s(271,0),new s(271,88),new s(320,164),new s(259,172),new s(184,152),new s(120,138)]),new o("003",this,"./stages/003/003.png",["./stages/003/p01.png","./stages/003/p02.png","./stages/003/p03.png","./stages/003/p04.png","./stages/003/p05.png","./stages/003/p06.png","./stages/003/p07.png","./stages/003/p08.png","./stages/003/p09.png","./stages/003/p10.png"],["./stages/003/h01.png","./stages/003/h02.png","./stages/003/h03.png","./stages/003/h04.png","./stages/003/h05.png","./stages/003/h06.png","./stages/003/h07.png","./stages/003/h08.png","./stages/003/h09.png","./stages/003/h10.png"],{has_voice:!0,has_sound:!1},{width:303,height:355},[new s(96,0),new s(16,23),new s(97,87),new s(1,145),new s(0,203),new s(55,196),new s(144,209),new s(195,281),new s(142,280),new s(40,277)]),new o("006",this,"./stages/006/006.png",["./stages/006/p01.png","./stages/006/p02.png","./stages/006/p03.png","./stages/006/p04.png"],["./stages/006/h01.png","./stages/006/h02.png","./stages/006/h03.png","./stages/006/h04.png"],{has_voice:!0,has_sound:!0},{width:290,height:385},[new s(83,0),new s(0,193),new s(168,284),new s(65,127)]),new o("008",this,"./stages/008/008.png",["./stages/008/p01.png","./stages/008/p02.png","./stages/008/p03.png","./stages/008/p04.png"],["./stages/008/h01.png","./stages/008/h02.png","./stages/008/h03.png","./stages/008/h04.png"],{has_voice:!0,has_sound:!0},{width:418,height:423},[new s(28,0),new s(0,257),new s(58,109),new s(185,0)]),new o("005",this,"./stages/005/005.png",["./stages/005/p01.png","./stages/005/p02.png","./stages/005/p03.png","./stages/005/p04.png","./stages/005/p05.png"],["./stages/005/h01.png","./stages/005/h02.png","./stages/005/h03.png","./stages/005/h04.png","./stages/005/h05.png"],{has_voice:!0,has_sound:!0},{width:341,height:416},[new s(40,0),new s(28,37),new s(176,37),new s(0,186),new s(175,179)]),new o("016",this,"./stages/016/016.png",["./stages/016/p01.png","./stages/016/p02.png","./stages/016/p03.png","./stages/016/p04.png"],["./stages/016/h01.png","./stages/016/h02.png","./stages/016/h03.png","./stages/016/h04.png"],{has_voice:!0,has_sound:!0},{width:486,height:489},[new s(73,0),new s(98,157),new s(0,268),new s(169,329)]),new o("011",this,"./stages/011/011.png",["./stages/011/p01.png","./stages/011/p02.png","./stages/011/p03.png","./stages/011/p04.png","./stages/011/p05.png"],["./stages/011/h01.png","./stages/011/h02.png","./stages/011/h03.png","./stages/011/h04.png","./stages/011/h05.png"],{has_voice:!0,has_sound:!1},{width:376,height:457},[new s(4,0),new s(53,46),new s(4,227),new s(178,227),new s(88,373)]),new o("012",this,"./stages/012/012.png",["./stages/012/p01.png","./stages/012/p02.png","./stages/012/p03.png","./stages/012/p04.png","./stages/012/p05.png"],["./stages/012/h01.png","./stages/012/h02.png","./stages/012/h03.png","./stages/012/h04.png","./stages/012/h05.png"],{has_voice:!0,has_sound:!0},{width:480,height:420},[new s(54,0),new s(0,101),new s(287,75),new s(59,242),new s(287,242)]),new o("015",this,"./stages/015/015.png",["./stages/015/p01.png","./stages/015/p02.png","./stages/015/p03.png","./stages/015/p04.png","./stages/015/p05.png"],["./stages/015/h01.png","./stages/015/h02.png","./stages/015/h03.png","./stages/015/h04.png","./stages/015/h05.png"],{has_voice:!0,has_sound:!1},{width:720,height:455},[new s(565,0),new s(438,184),new s(315,105),new s(0,50),new s(138,157)]),new o("004",this,"./stages/004/004.png",["./stages/004/p01.png","./stages/004/p02.png","./stages/004/p03.png","./stages/004/p04.png","./stages/004/p05.png","./stages/004/p06.png"],["./stages/004/h01.png","./stages/004/h02.png","./stages/004/h03.png","./stages/004/h04.png","./stages/004/h05.png","./stages/004/h06.png"],{has_voice:!0,has_sound:!0},{width:467,height:333},[new s(0,173),new s(49,66),new s(207,0),new s(286,24),new s(115,120),new s(170,115)]),new o("007",this,"./stages/007/007.png",["./stages/007/p01.png","./stages/007/p02.png","./stages/007/p03.png","./stages/007/p04.png","./stages/007/p05.png","./stages/007/p06.png"],["./stages/007/h01.png","./stages/007/h02.png","./stages/007/h03.png","./stages/007/h04.png","./stages/007/h05.png","./stages/007/h06.png"],{has_voice:!0,has_sound:!0},{width:332,height:425},[new s(0,61),new s(144,0),new s(27,38),new s(26,58),new s(95,226),new s(193,215)]),new o("009",this,"./stages/009/009.png",["./stages/009/p01.png","./stages/009/p02.png","./stages/009/p03.png","./stages/009/p04.png","./stages/009/p05.png","./stages/009/p06.png"],["./stages/009/h01.png","./stages/009/h02.png","./stages/009/h03.png","./stages/009/h04.png","./stages/009/h05.png","./stages/009/h06.png"],{has_voice:!0,has_sound:!0},{width:418,height:651},[new s(79,0),new s(0,118),new s(54,512),new s(294,538),new s(102,346),new s(247,341)]),new o("010",this,"./stages/010/010.png",["./stages/010/p01.png","./stages/010/p02.png","./stages/010/p03.png","./stages/010/p04.png","./stages/010/p05.png","./stages/010/p06.png"],["./stages/010/h01.png","./stages/010/h02.png","./stages/010/h03.png","./stages/010/h04.png","./stages/010/h05.png","./stages/010/h06.png"],{has_voice:!0,has_sound:!0},{width:316,height:445},[new s(4,0),new s(12,90),new s(0,276),new s(162,272),new s(12,363),new s(162,363)]),new o("013",this,"./stages/013/013.png",["./stages/013/p01.png","./stages/013/p02.png","./stages/013/p03.png","./stages/013/p04.png","./stages/013/p05.png","./stages/013/p06.png"],["./stages/013/h01.png","./stages/013/h02.png","./stages/013/h03.png","./stages/013/h04.png","./stages/013/h05.png","./stages/013/h06.png"],{has_voice:!0,has_sound:!0},{width:641,height:425},[new s(0,112),new s(375,0),new s(81,0),new s(273,212),new s(364,212),new s(508,212)]),new o("014",this,"./stages/014/014.png",["./stages/014/p01.png","./stages/014/p02.png","./stages/014/p03.png","./stages/014/p04.png","./stages/014/p05.png","./stages/014/p06.png"],["./stages/014/h01.png","./stages/014/h02.png","./stages/014/h03.png","./stages/014/h04.png","./stages/014/h05.png","./stages/014/h06.png"],{has_voice:!0,has_sound:!0},{width:505,height:491},[new s(0,0),new s(37,58),new s(191,264),new s(286,315),new s(391,309),new s(339,188)]),new o("017",this,"./stages/017/017.png",["./stages/017/p01.png","./stages/017/p02.png","./stages/017/p03.png","./stages/017/p04.png","./stages/017/p05.png","./stages/017/p06.png"],["./stages/017/h01.png","./stages/017/h02.png","./stages/017/h03.png","./stages/017/h04.png","./stages/017/h05.png","./stages/017/h06.png"],{has_voice:!0,has_sound:!0},{width:539,height:348},[new s(0,0),new s(125,223),new s(292,223),new s(203,26),new s(291,24),new s(444,72)]),new o("018",this,"./stages/018/018.png",["./stages/018/p01.png","./stages/018/p02.png","./stages/018/p03.png","./stages/018/p04.png","./stages/018/p05.png","./stages/018/p06.png"],["./stages/018/h01.png","./stages/018/h02.png","./stages/018/h03.png","./stages/018/h04.png","./stages/018/h05.png","./stages/018/h06.png"],{has_voice:!0,has_sound:!1},{width:671,height:456},[new s(0,225),new s(274,225),new s(435,186),new s(206,0),new s(206,186),new s(87,47)]),new o("019",this,"./stages/019/019.png",["./stages/019/p01.png","./stages/019/p02.png","./stages/019/p03.png","./stages/019/p04.png","./stages/019/p05.png","./stages/019/p06.png","./stages/019/p07.png"],["./stages/019/h01.png","./stages/019/h02.png","./stages/019/h03.png","./stages/019/h04.png","./stages/019/h05.png","./stages/019/h06.png","./stages/019/h07.png"],{has_voice:!0,has_sound:!0},{width:453,height:488},[new s(0,3),new s(205,0),new s(13,235),new s(229,235),new s(159,404),new s(297,404),new s(374,263)]),new o("020",this,"./stages/020/020.png",["./stages/020/p01.png","./stages/020/p02.png","./stages/020/p03.png","./stages/020/p04.png","./stages/020/p05.png","./stages/020/p06.png","./stages/020/p07.png","./stages/020/p08.png"],["./stages/020/h01.png","./stages/020/h02.png","./stages/020/h03.png","./stages/020/h04.png","./stages/020/h05.png","./stages/020/h06.png","./stages/020/h07.png","./stages/020/h08.png"],{has_voice:!0,has_sound:!0},{width:330,height:380},[new s(0,73),new s(70,8),new s(92,105),new s(258,172),new s(234,278),new s(52,273),new s(204,215),new s(121,214)])],this.puzzle=this.puzzles[this.stage-1],this.puzzle.init(),this.applyScale()}applyScale(){var e=this.originalWidth,t=this.originalHeight;this.puzzle.width!=null&&(e=this.puzzle.width*2,t=this.puzzle.height*2),document.getElementById("canvas").width=window.innerWidth,document.getElementById("canvas").height=window.innerHeight;var a=window.innerWidth/e,i=window.innerHeight/t;this.scale=Math.min(a,i),this.context.scale(this.scale,this.scale),console.log(`scale: ${this.scale}`)}render(){this.drawBackground(),this.assetManager.isLoaded?(this.puzzle.draw(),this.drawRemaining()):this.drawLoading(),this.debug&&this.assetManager.isLoaded&&this.puzzle.assetManager.isLoaded&&(document.getElementById("debug_x").value=this.pointer.x,document.getElementById("debug_y").value=this.pointer.y,document.getElementById("debug_width").value=this.puzzle.width,document.getElementById("debug_height").value=this.puzzle.height,document.getElementById("debug_moving").value=this.pointer.moving,document.getElementById("debug_pieces").value=this.puzzle.numberOfPieces,document.getElementById("debug_placed").value=this.puzzle.placedPieces.length,this.selected?(document.getElementById("debug_selected").value=this.selected.id,document.getElementById("debug_px").value=this.selected.position.x,document.getElementById("debug_py").value=this.selected.position.y,document.getElementById("debug_hx").value=this.puzzle.holders[this.selected.id].position.x,document.getElementById("debug_hy").value=this.puzzle.holders[this.selected.id].position.y):document.getElementById("debug_selected").value="")}loop(){this.render(),this.animationFrameRequestID=requestAnimationFrame(()=>{this.loop()})}drawBackground(){if(this.scale||(this.scale=1),this.context.fillStyle="rgba(125, 125, 125, 1)",this.context.fillRect(0,0,this.canvas.width/this.scale,this.canvas.height/this.scale),this.puzzle.placedPieces){this.context.save();var e=this.context.createRadialGradient(this.canvas.width/this.scale/2,this.canvas.height/this.scale/2,0,this.canvas.width/this.scale/2,this.canvas.height/this.scale/2,this.canvas.width/this.scale);this.puzzle.num_pieces>this.puzzle.placedPieces.length?(e.addColorStop(1,["rgb(",256,", ",256,", ",256,")"].join("")),e.addColorStop(0,["rgb(",100,", ",100,", ",100,")"].join(""))):(e.addColorStop(0,["rgb(",256,", ",256,", ",256,")"].join("")),e.addColorStop(1,["rgb(",100,", ",100,", ",100,")"].join(""))),this.context.fillStyle=e,this.context.fillRect(0,0,this.canvas.width/this.scale,this.canvas.height/this.scale),this.context.restore()}}drawRemaining(){this.context.save(),this.fade1=this.fade1+.01*this.alpha,this.fade1>=.6?this.alpha=-1:this.fade1<=.2&&(this.alpha=1),this.context.fillStyle="rgba(255, 255, 255, "+this.fade1+")",this.context.strokeStyle="rgba(0, 0, 0, 0.5)",this.context.lineWidth=2,this.context.font="bold "+this.fontSize+"px Arial",this.context.textBaseline="top",this.context.textAlign="left",this.context.strokeText(this.puzzle.remainingTime,10,40),this.context.fillText(this.puzzle.remainingTime,10,40);var e=this.context.measureText(this.stage+"/"+this.puzzles.length+" ");this.context.strokeText(this.stage+"/"+this.puzzles.length,this.canvas.width/this.scale-e.width,40),this.context.fillText(this.stage+"/"+this.puzzles.length,this.canvas.width/this.scale-e.width,40),this.context.restore()}drawLoading(){this.fade1=this.fade1+.025,this.fade1>=1&&(this.fade1=0),this.fade2=1-this.fade1,this.context.fillStyle="rgba(255, 255, 255, "+this.fade2+")",this.context.strokeStyle="rgba(255, 255, 255, "+this.fade1+")",this.context.font="bold "+this.fontSize+"px Arial",this.context.textBaseline="middle",this.context.textAlign="center",this.context.lineWidth=5,this.context.strokeText("LOADING",this.canvas.width/this.scale/2,this.canvas.height/this.scale/2),this.context.fillText("LOADING",this.canvas.width/this.scale/2,this.canvas.height/this.scale/2)}getTimer(){return new Date().getTime()-this.start_time}nextStage(){this.stage+1>this.puzzles.length?(this.isOver=!0,this.stopGame()):(this.isOver=!1,this.stage++,this.puzzle=this.puzzles[this.stage-1],this.puzzle.init(),this.startGame(),this.resumeGame())}stopGame(){clearInterval(this.gameInterval),this.started=!1,this.stopSFX(),this.stopBGM(),cancelAnimationFrame(this.animationFrameRequestID),landing.classList.remove("hidden"),app.classList.add("hidden")}startGame(){this.started||(window.scrollTo(0,0),stage_modal.close(),landing.classList.add("hidden"),app.classList.remove("hidden"),this.gameInterval=setInterval(()=>{this.puzzle.remainingTime--},1e3),this.started=!0,this.startSFX(),this.startBGM(),this.assetManager.get("drip").play(),console.log("Start"),this.animationFrameRequestID=requestAnimationFrame(()=>{this.loop()}))}pauseGame(){this.paused||(console.log("Pause"),this.selected=null,clearInterval(this.gameInterval),this.paused=!0,cancelAnimationFrame(this.animationFrameRequestID),settings_bgm.checked&&this.assetManager.get("bgm").pause(),fab_button_pause.classList.remove("btn-error"),fab_button_pause.classList.add("btn-success"),menu.classList.remove("hidden"))}resumeGame(){this.paused&&(console.log("Resume"),this.paused=!1,this.gameInterval=setInterval(()=>{this.puzzle.remainingTime--},1e3),this.animationFrameRequestID=requestAnimationFrame(()=>{this.loop()}),settings_bgm.checked&&this.assetManager.get("bgm").play(),fab_button_pause.classList.add("btn-error"),fab_button_pause.classList.remove("btn-success"),menu.classList.add("hidden"))}stopSFX(){window.game.assetManager.get("drip").volume=0,window.game.assetManager.get("twang").volume=0,window.game.assetManager.get("drip").pause(),window.game.assetManager.get("twang").pause()}startSFX(){window.game.assetManager.get("drip").volume=1,window.game.assetManager.get("twang").volume=1}stopBGM(){window.game.assetManager.get("bgm").volume=0,window.game.assetManager.get("bgm").pause()}startBGM(){window.game.assetManager.get("bgm").volume=1,window.game.assetManager.get("bgm").loop=!0,window.game.assetManager.get("bgm").play()}autoSnapOn(){window.game.autoSnap=!0}autoSnapOff(){window.game.autoSnap=!1}fullscreen(){window.game.canvas.requestFullscreen()}exitfullscreen(){document.exitFullscreen()}resizeGame(){console.log(`window: ${window.innerWidth}x${window.innerHeight}`),window.game.started&&(window.game.applyScale(),window.game.puzzle.placeHolderAndPiecesAgain())}work4me(){this.puzzle.pieces.forEach(e=>{e.position.x=e.holder.position.x,e.position.y=e.holder.position.y,this.selected=e,this.selected.placed=!0,this.selected.movable=!1,this.puzzle.placedPieces.push(this.selected)})}}function v(h){console.log(h);{var e=document.createElement("script");e.async=!0,e.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3970758666730748",e.crossorigin="anonymous";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}}v("production");function r(h){h==="dark"?(localStorage.theme="dark",document.documentElement.setAttribute("data-theme","dark"),document.documentElement.classList.remove("light"),document.documentElement.classList.add("dark")):(localStorage.theme="light",document.documentElement.setAttribute("data-theme","light"),document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"))}document.addEventListener("DOMContentLoaded",()=>{console.log("DOMContentLoaded"),footer_year.textContent=new Date().getFullYear(),document.documentElement.classList.toggle("dark",localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches),localStorage.theme==="dark"?(theme_toggle.checked=!0,r("dark")):(theme_toggle.checked=!1,r("light")),console.log(localStorage.theme),theme_toggle.addEventListener("change",()=>{theme_toggle.checked?r("dark"):r("light"),console.log(localStorage.theme)}),playNow.addEventListener("click",()=>{landing.classList.add("hidden"),app.classList.remove("hidden"),window.game=new w(document.getElementById("canvas")),window.game.init(),window.game.debug=!0,window.onresize=()=>{window.game.resizeGame()}}),screen.orientation.addEventListener("change",h=>{window.game.resizeGame(),console.log(`ScreenOrientation change: ${h.target.type}, ${h.target.angle} degrees.`)}),canvas.addEventListener("fullscreenchange",()=>{document.fullscreenElement?settings_fullscreen.checked=!0:settings_fullscreen.checked=!1}),stage_next.addEventListener("click",()=>{if(window.game.puzzle.hasVoice){var h=window.game.puzzle.assetManager.get(`puzzle_${window.game.puzzle.id}_voice`);h.pause(),h.currentTime=0}if(window.game.puzzle.hasSound){var e=window.game.puzzle.assetManager.get(`puzzle_${window.game.puzzle.id}_sound`);e.pause(),e.currentTime=0}window.game.nextStage(),stage_modal.close()}),stage_voice.addEventListener("click",()=>{if(window.game.puzzle.hasVoice&&!stage_voice.getAttribute("disabled")){var h=window.game.puzzle.assetManager.get(`puzzle_${window.game.puzzle.id}_voice`);h.addEventListener("ended",()=>{stage_voice.removeAttribute("disabled")}),stage_voice.setAttribute("disabled",!0),h.play()}}),stage_sound.addEventListener("click",()=>{if(window.game.puzzle.hasSound&&!stage_sound.getAttribute("disabled")){var h=window.game.puzzle.assetManager.get(`puzzle_${window.game.puzzle.id}_sound`);h.addEventListener("ended",()=>{stage_sound.removeAttribute("disabled")}),stage_sound.setAttribute("disabled",!0),h.play()}}),fab_button_pause.addEventListener("click",()=>{console.log("fab_button_pause"),window.game.paused?window.game.resumeGame():window.game.pauseGame()}),settings_fullscreen.addEventListener("change",()=>{settings_fullscreen.checked?window.game.fullscreen():window.game.exitfullscreen()}),settings_bgm.addEventListener("change",()=>{settings_bgm.checked?window.game.startBGM():window.game.stopBGM()}),settings_sfx.addEventListener("change",()=>{settings_sfx.checked?window.game.startSFX():window.game.stopSFX()}),settings_autosnap.addEventListener("change",()=>{settings_autosnap.checked?window.game.autoSnapOn():window.game.autoSnapOff()}),settings_button_close.addEventListener("click",()=>{window.game.resumeGame()}),window.toggleDebug=()=>{debugging.classList.toggle("hidden")},window.addEventListener("keydown",h=>{h.code==="Escape"&&h.preventDefault()})});
